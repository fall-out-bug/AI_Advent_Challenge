# Day 12 - PDF Digest User Guide

## Overview

The PDF Digest feature allows you to generate PDF documents containing summaries of posts from your subscribed Telegram channels. PDFs are generated on-demand via the Telegram bot and cached for 1 hour to improve performance.

## Quick Start

1. **Subscribe to channels** via the bot's channel management
2. **Wait for posts to be collected** (posts are collected hourly by the worker)
3. **Click "Digest" button** in the bot menu
4. **Receive PDF** with channel summaries

## How to Use

### Step 1: Subscribe to Channels

Before generating a digest, you need to subscribe to Telegram channels:

1. Open the bot menu
2. Navigate to "ðŸ“° Channels"
3. Add channels you want to follow
4. Wait for posts to be collected (hourly collection)

### Step 2: Generate PDF Digest

1. Open the bot menu (`/menu` command)
2. Click "ðŸ“® Digest" button
3. Bot will show "uploading document" action
4. Receive PDF file with channel summaries

### Step 3: Reading the PDF

The PDF contains:
- Header with generation date and statistics
- Sections for each channel:
  - Channel name as heading
  - Summary text (5-6 sentences)
  - Number of posts processed
- Footer with metadata

**Example PDF Structure:**
```
# Telegram Channel Digest

Generated: 2024-01-15T20:00:00Z

---

# Channel Digest

Generated: 2024-01-15T20:00:00Z
Channels: 3 | Total Posts: 25

## channel1

Summary text generated by AI for channel1 posts...

*Posts processed: 10*

## channel2

Summary text for channel2...

*Posts processed: 8*

## channel3

Summary text for channel3...

*Posts processed: 7*

---

*End of digest*
```

## Features

### PDF Format

- **A4 page size** with 2cm margins
- **Professional styling** with Arial/Helvetica fonts
- **Clear section headings** for easy navigation
- **Page breaks** between major sections

### Caching

- PDFs are **cached for 1 hour** by date and hour
- **Cache hit**: PDF sent immediately (no regeneration)
- **Cache miss**: PDF generated on-demand
- Cache is **user-specific** (each user has separate cache)

### Limits

- **Max 100 posts per channel** (prevents token overflow)
- **Max 10 channels** per digest (configurable)
- **5-6 sentences per channel** summary (optimized for readability)
- **Max 3000 characters** per summary (prevents PDF bloat)

### Error Handling

The system gracefully handles errors:

- **No posts**: Bot sends message "No new posts in last 24 hours"
- **PDF generation fails**: Falls back to text digest automatically
- **Empty digest**: Bot sends message "No digests available yet"
- **Database errors**: Logged and handled gracefully

## Troubleshooting

### "No new posts in last 24 hours"

**Cause:** No posts found in database for your subscribed channels in the last 24 hours.

**Solutions:**
- Wait for posts to be collected by the worker (hourly collection)
- Check that channels are properly subscribed
- Verify posts exist in subscribed channels

### PDF Generation Failed

**Cause:** PDF conversion error (weasyprint dependency, invalid markdown, etc.)

**Solutions:**
- System automatically falls back to text digest
- Check bot logs for detailed error messages
- Try again after a few minutes
- Contact support if issue persists

### Empty Digest

**Cause:** No summaries generated (empty posts, LLM errors)

**Solutions:**
- Wait for more posts to accumulate
- Check channel subscriptions
- Try again later

### Slow PDF Generation

**Cause:** First-time generation (cache miss) or high number of channels

**Solutions:**
- Wait for PDF to be generated (usually 10-30 seconds)
- Cached PDFs are sent instantly
- Reduce number of subscribed channels

## Best Practices

### For Best Results

1. **Subscribe to 5-10 channels** for optimal digest size
2. **Wait for hourly collection** before requesting digest
3. **Use during low-traffic hours** for faster generation
4. **Keep channels active** - posts are collected hourly

### For Faster Generation

1. **Use cached PDFs** - request digest within same hour
2. **Limit channels** - fewer channels = faster generation
3. **Reduce post limits** - fewer posts = faster summarization

## Configuration

PDF digest settings can be configured via environment variables:

```bash
# PDF Cache (hours)
PDF_CACHE_TTL_HOURS=1

# Summary Settings
PDF_SUMMARY_SENTENCES=5
PDF_SUMMARY_MAX_CHARS=3000
PDF_MAX_POSTS_PER_CHANNEL=100

# Digest Limits
DIGEST_MAX_CHANNELS=10
```

## FAQ

### Q: How often are PDFs generated?

**A:** PDFs are generated on-demand when you click the "Digest" button. They are cached for 1 hour, so requesting again within the same hour returns the cached version.

### Q: How many posts are included?

**A:** Up to 100 posts per channel, with a maximum of 10 channels per digest. Older posts beyond the limit are excluded.

### Q: Can I customize the PDF format?

**A:** Currently, PDF format is fixed. Future versions may support templates and customization.

### Q: What happens if a channel has no posts?

**A:** Channels with no posts are excluded from the digest automatically.

### Q: How long does PDF generation take?

**A:** Usually 10-30 seconds for first-time generation. Cached PDFs are sent instantly.

### Q: Can I get PDFs for different time periods?

**A:** Currently, PDFs cover the last 24 hours. This is configurable in future versions.

### Q: What if LLM summarization fails?

**A:** System falls back to a simple concatenation of first 5 posts (200 chars each) as summary.

### Q: Are PDFs automatically sent?

**A:** No, PDFs are generated only when you request them via the bot menu.

## Support

For issues or questions:
1. Check bot logs for error messages
2. Review this user guide
3. Check API documentation: `docs/day12/api.md`
4. Contact support with error details

## Technical Details

- **PDF Generation**: weasyprint library
- **Markdown Parsing**: markdown library with extra extensions
- **Storage**: MongoDB with 7-day TTL
- **Caching**: In-memory cache (1 hour TTL)
- **Worker**: Hourly post collection via PostFetcherWorker

For technical documentation, see:
- API Documentation: `docs/day12/api.md`
- Architecture: `docs/day12/ARCHITECTURE.md`

