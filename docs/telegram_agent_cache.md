Наш телеграм‑бот держит «память» агента в кэше — как внимательный библиотекарь, который заранее кладёт на стол нужные книги. Сейчас бот сфокусирован на управлении каналами и дайджестами; исторические задачи и напоминания отключены. Мы используем многоуровневый подход: самый быстрый слой — оперативная память для горячих диалогов; ключ формируется из user_id и контекста, а TTL отвечает за свежесть данных. Когда информация «остывает», она мигрирует в персистентный слой (например, Redis/диск), чтобы пережить перезапуски.

Обновления проходят атомарно: читаем текущую версию и применяем compare‑and‑set, избегая гонок при параллельных сообщениях. Размеры ограничены политикой LRU — редкие записи вытесняются, часто используемые остаются «под рукой». Для приватности мы хэшируем идентификаторы и не кэшируем чувствительные поля вовсе. Метрики следят за hit rate и задержками; если показатель падает, адаптируем TTL и лимиты.

Результат — агент отвечает почти мгновенно, экономя запросы к базе и внешним API, а пользователь ощущает плавный, «разговорный» ритм без провалов памяти, даже после рестартов.

