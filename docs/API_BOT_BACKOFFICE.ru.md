# CLI Backoffice бота (RU)

Детерминированный интерфейс командной строки, повторяющий сценарии Telegram
бота (подписки/дайджесты) без распознавания интентов. Предназначен только для
владельца.

## 1. Установка

CLI будет располагаться в `src/presentation/cli/backoffice/` (в разработке).
Документ фиксирует требуемый набор команд для реализации.

## 2. Обзор команд

| Команда | Назначение | Статус |
|---------|------------|--------|
| `channels list` | Список подписок | Планируется |
| `channels add` | Подписка на канал | Планируется |
| `channels remove` | Отписка от канала | Планируется |
| `channels refresh` | Принудительный сбор постов | Планируется |
| `digest run` | Генерация дайджеста | Планируется |
| `digest last` | Просмотр последнего дайджеста | Планируется |
| `nlp test` | Проверка NLP-классификатора | Опционально |

Флаг `--output json` выводит результат в JSON; по умолчанию табличный/markdown
формат.

## 3. Команды для каналов

### 3.1 `channels list`

```
butler-cli channels list [--limit N] [--include-tags] [--output json]
```

Вывод (таблица или JSON):

| Канал | Заголовок | Теги | Активен | С |

### 3.2 `channels add`

```
butler-cli channels add --username <имя> [--tags тег1,тег2]
```

Коды возврата:

- `0` — подписка создана
- `1` — ошибка (канал не найден, уже подписан)

### 3.3 `channels remove`

```
butler-cli channels remove (--channel-id <id> | --username <имя>)
```

Вывод: `removed` или `not_found`.

### 3.4 `channels refresh`

```
butler-cli channels refresh (--channel-id <id> | --username <имя>) [--hours 24]
```

Планирует задачу на сбор постов; выводит идентификатор/статус.

## 4. Команды дайджестов

### 4.1 `digest run`

```
butler-cli digest run --channel <имя> [--hours 24] [--format markdown|json]
```

Возвращает дайджест (markdown по умолчанию). JSON соответствует ответу
`digest_generate`.

### 4.2 `digest last`

```
butler-cli digest last --channel <имя>
```

Показывает время генерации, количество постов, краткое содержание.

## 5. NLP-команда (опционально)

```
butler-cli nlp test --text "покажи дайджест tech news"
```

Используется для проверки классификатора и регрессионных тестов.

## 6. Примечания к реализации

- CLI должен переиспользовать MCP-инструменты (`API_MCP.md` / `.ru.md`).
- Логирование — с `trace_id` или уникальным идентификатором команды.
- Аутентификация: только владелец (через env или локальный профиль).
- Потенциальные улучшения: массовые операции, импорт/экспорт CSV, планировщик.

## 7. Локализация

- По умолчанию вывод на русском (`--lang en` для английского).
- Сообщения помощи и ошибки должны быть доступны на двух языках (см. EN версию).

