# Epic 20 · Summary

## Goals
- Сравнить ответы чистого LLM и RAG-режима, используя индекс из Epic 19.
- Предоставить CLI/агента с режимами `no-context` и `with-context`, фиксируя контекст и вывод.
- Сформировать набор вопросов, конфигурацию retrieval, оценочный рубеж и отчёт о влиянии RAG.

## Архитектурные решения
- Домен/приложение/инфраструктура/презентация реализованы по Clean Architecture; RAG сервисы используют протоколы и внедряются через DI.
- RetrievalService опирается на адаптер FAISS/Redis из EP19, PromptAssembler управляет контекстным бюджетом и шаблонами.
- CLI команды `rag compare` и `rag batch` используют общий use case, обеспечивая единый путь логирования и метрик.

## Реализация
- Подготовлены артефакты: `queries.jsonl`, `retrieval_config.yaml`, `prompt_templates.md`, а также рубрика ручной оценки.
- Реализованы value objects и сервисы для RAG; покрыты 32 юнит-теста (домен) и 7 application тестов, добавлены интеграционные и CLI smoke tests.
- Batch-прогон завершён, результаты сохранены (`results_stage20.jsonl`, `results_with_labels.jsonl`), подготовлен промежуточный отчёт.
- Выявлены зоны улучшения (резервирование запроса, устойчивость LLM); предложены ретраи и ручная перекалибровка меток для Stage 20_04.
