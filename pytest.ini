[pytest]
# Pytest configuration for AI Challenge project

# Test discovery
testpaths = tests
pythonpath = .
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# Ignore legacy or external test suites that rely on deprecated modules
norecursedirs =
    tests/legacy
    tests/fixtures/airflow_only
    tests/epic21

# Coverage
addopts =
    --verbose
    --strict-markers
    --tb=short
    --color=yes
    --import-mode=importlib
    -ra

# Markers
markers =
    # Existing markers
    unit: Unit tests
    integration: Integration tests
    e2e: End-to-end tests
    slow: Slow running tests

    # Epic 21 markers (added 2025-11-11)
    epic21: Tests related to Epic 21 refactoring
    stage_21_00: Stage 21_00 (Preparation)
    stage_21_01: Stage 21_01 (Architecture & Layering)
    stage_21_02: Stage 21_02 (Code Quality)
    stage_21_03: Stage 21_03 (Testing & Observability)

    # Component markers
    dialog_context: Dialog context repository tests
    homework_service: Homework review service tests
    storage: Storage adapter tests
    logs: Log analysis tests
    use_case: Use case decomposition tests

    # Test type markers (Epic 21)
    characterization: Tests capturing current behavior before refactoring
    performance: Performance/latency tests with SLO validation
    security: Security-focused tests (checksum, AV scan, path traversal)

    # Infrastructure markers
    requires_mongo: Test requires MongoDB connection
    requires_redis: Test requires Redis connection
    requires_llm: Test requires LLM API access

# Asyncio
asyncio_mode = auto

# Warnings
filterwarnings =
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
