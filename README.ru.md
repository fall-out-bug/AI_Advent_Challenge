# AI Advent Challenge

[English](README.md) | [Русский](README.ru.md)

> Ежедневные AI-проекты для изучения языковых моделей и мультиагентных систем

## Обзор

Этот репозиторий содержит ежедневные задачи по созданию AI-систем с языковыми моделями. Каждый день вводит новые концепции и основывается на предыдущих задачах.

**Текущий статус:** ✅ День 15 завершен - Самосовершенствующаяся LLM-система с оценкой качества и файнтюнингом

**Статус проекта:**
- ✅ 15 ежедневных задач завершено
- ✅ Clean Architecture полностью реализована
- ✅ 420+ тестов с 80%+ покрытием
- ✅ Production-ready мультиагентная система с самосовершенствованием
- ✅ Автоматическая оценка качества и файнтюнинг
- ✅ Полная документация для AI-ассистентов

**Ключевые возможности:**
- ✅ 15 ежедневных задач от простого чата до самосовершенствующихся AI-систем
- ✅ Clean Architecture с принципами SOLID
- ✅ 420+ тестов с 80%+ покрытием
- ✅ Поддержка множества моделей (StarCoder, Mistral, Qwen, TinyLlama)
- ✅ Интеграция MCP (Model Context Protocol) с HTTP сервером
- ✅ MCP-aware агент с автоматическим обнаружением и выполнением инструментов
- ✅ Telegram бот с FSM-based диалогами и созданием задач на естественном языке
- ✅ **Гибридное распознавание намерений** (Правила + LLM с кешированием)
- ✅ **Интеграция HW Checker** (all_checks_status, queue_status, retry_check)
- ✅ **Ревью домашних работ через Telegram** (список домашних работ, ревью по commit hash)
- ✅ Дайджесты каналов с поддержкой метаданных (заголовок, описание)
- ✅ Генерация PDF-дайджестов с автоматическим сбором постов
- ✅ Централизованная система логирования со структурированным выводом
- ✅ Мониторинг работоспособности и метрики dashboard
- ✅ Hotreload для разработки (uvicorn --reload + watchdog)
- ✅ **Multi-Pass Code Review** (3-проходная архитектура для анализа домашних работ)
- ✅ **LLM-as-Judge оценка качества** (автоматическая оценка суммаризаций)
- ✅ **Самосовершенствующаяся система** (автоматический файнтюнинг на качественных данных)

## Быстрый старт

```bash
# Установить зависимости
make install

# Запустить тесты
make test

# Запустить API
make run-api

# Запустить CLI
make run-cli
```

Подробные инструкции по настройке см. в [DEVELOPMENT.md](docs/DEVELOPMENT.md).

## Структура проекта

```
AI_Challenge/
├── src/              # Clean Architecture Core
│   ├── domain/      # Слой бизнес-логики
│   ├── application/ # Use cases и orchestrators
│   ├── infrastructure/ # Внешние интеграции
│   └── presentation/   # API и CLI
├── tasks/           # Ежедневные задачи (day_01 - day_15)
├── local_models/    # Инфраструктура локальных моделей
├── shared/          # Унифицированный SDK для взаимодействия с моделями
├── scripts/         # Утилитарные скрипты
├── config/          # Конфигурационные файлы
└── docs/            # Полная документация
```

## Ежедневные задачи

| День | Область фокуса | Ключевые технологии | Статус |
|------|----------------|---------------------|--------|
| День 1 | Базовый чат-интерфейс | Python, API | ✅ Завершено |
| День 2 | JSON-структурированные ответы | Python, JSON parsing | ✅ Завершено |
| День 3 | Режим советника | Python, Управление сессиями | ✅ Завершено |
| День 4 | Контроль температуры | Python, Экспериментирование | ✅ Завершено |
| День 5 | Локальные модели | SDK, Docker, FastAPI | ✅ Завершено |
| День 6 | Тестовый фреймворк | Тестирование, Генерация отчетов | ✅ Завершено |
| День 7 | Мультиагентные системы | FastAPI, Docker, Оркестрация | ✅ Завершено |
| День 8 | Анализ токенов | Clean Architecture, ML Engineering | ✅ Завершено |
| День 9 | Интеграция MCP | MCP Protocol, Управление контекстом | ✅ Завершено |
| День 10 | Production-Ready MCP | Оркестрация, стриминг, кеширование | ✅ Завершено |
| День 11 | Butler Bot FSM | Telegram Bot, FSM, Intent Parsing | ✅ Завершено |
| День 12 | Система PDF-дайджестов | MongoDB, PDF Generation, MCP Tools | ✅ Завершено |
| День 13 | Рефакторинг Butler Agent | Hybrid Intent Recognition, HW Checker, Metadata | ✅ Завершено |
| День 14 | Multi-Pass Code Review | MCP Homework Review, 3-проходный анализ | ✅ Завершено |
| День 15 | Оценка качества и файнтюнинг | LLM-as-Judge, Самосовершенствующаяся система, Hugging Face | ✅ Завершено |

## Основная инфраструктура

### Локальные модели
- **Qwen-4B** (порт 8000) - Быстрые ответы, ~8GB RAM
- **Mistral-7B** (порт 8001) - Высокое качество, ~14GB RAM  
- **TinyLlama-1.1B** (порт 8002) - Компактный, ~4GB RAM
- **StarCoder-7B** (порт 9000) - Специализирован для генерации кода

### Общий SDK
Унифицированный SDK для взаимодействия с моделями во всех задачах.

```python
from shared.clients.model_client import ModelClient
client = ModelClient(provider="perplexity")
response = await client.chat("Привет, мир!")
```

## Docker Compose файлы

Проект использует несколько docker-compose файлов для разных сценариев:

- **`docker-compose.yml`** - Основные/дефолтные сервисы (MongoDB, базовая настройка)
- **`docker-compose.butler.yml`** - **Production система** с оценкой качества и файнтюнингом (День 15)
- **`docker-compose.day11.yml`** - Система Butler Bot (Telegram бот, MCP сервер, Mistral)
- **`docker-compose.mcp-demo.yml`** - Демо-сервисы MCP для тестирования

**Быстрый старт:**
```bash
# Butler (production система с самосовершенствованием)
make butler-up

# День 11 (только Butler Bot)
make day-11-up

# MCP Demo
make mcp-demo-start

# Legacy алиасы (поддерживаются для совместимости)
make day-12-up  # То же что make butler-up
```

## Текущие возможности (День 15)

**Самосовершенствующаяся LLM-система:**
- **LLM-as-Judge**: Автоматическая оценка качества с использованием Mistral (полнота, точность, связность, информативность)
- **Автоматический файнтюнинг**: Самосовершенствование путем обучения на качественных образцах (триггер при 100+ образцах)
- **Асинхронная оценка**: Паттерн fire-and-forget, не блокирует основной поток
- **Расширяемая архитектура**: Поддержка различных типов задач файнтюнинга (суммаризация, классификация, Q&A)
- **ML в Docker**: Полная интеграция Hugging Face Transformers в контейнерах
- **Управление датасетами**: Автоматический экспорт JSONL для файнтюнинга

**Система Butler Agent:**
- **Гибридное распознавание намерений**: Двухслойная архитектура (правила + LLM fallback) с кешированием
- **Интеграция HW Checker**: Полный мониторинг статуса, управление очередью и повторные попытки
- **Ревью домашних работ**: Список недавних коммитов и выполнение code review через Telegram бот
- **Multi-Pass Code Review**: 3-проходная архитектура (Architecture → Component → Synthesis) для комплексного анализа кода
- **Метаданные каналов**: Автоматическое получение заголовка и описания из Telegram API
- **Улучшенные дайджесты**: Адаптивная длина резюме на основе количества постов, временные промпты
- **Экранирование Markdown**: Безопасное форматирование сообщений для Telegram
- **Hotreload для разработки**: Быстрая итерация с автоматической перезагрузкой кода

**Система генерации PDF-дайджестов:**
- Генерация PDF-дайджестов через MCP инструменты (5 инструментов)
- Автоматический часовой сбор постов через `PostFetcherWorker`
- Гибридная дедупликация (message_id + content_hash)
- Кеширование PDF с TTL 1 час для мгновенной доставки
- Хранение в MongoDB с TTL 7 дней для автоматической очистки

**MCP-Aware Агент:**
- Автоматическое обнаружение инструментов через MCPToolsRegistry (кэш 5 минут)
- Выбор и выполнение инструментов на основе LLM
- Надежная логика повторных попыток с экспоненциальной задержкой
- Управление историей диалогов с автоматическим сжатием
- Интеграция метрик Prometheus

**Команды для ревью домашних работ:**
- `Покажи домашки` - Список недавних коммитов домашних работ со статусом
- `Сделай ревью {commit_hash}` - Скачать архив и выполнить code review
- Результаты ревью отправляются как Markdown файлы через Telegram

**День 14 - Multi-Pass Code Review:**
- 3-проходная архитектура для комплексного анализа кода
- Автоматическое обнаружение компонентов (Airflow, Spark, MLflow, Docker)
- Технологически-специфичный глубокий анализ
- Синтез интеграции и рекомендации
- Генерация Markdown отчетов с haiku-резюме

См. [docs/day12/USER_GUIDE.md](docs/day12/USER_GUIDE.md) для руководства пользователя и [docs/day12/api.md](docs/day12/api.md) для документации API.

## Поддержка AI-ассистентов

Этот репозиторий включает полную документацию для разработки с помощью AI:

- **[AI_CONTEXT.md](AI_CONTEXT.md)** - Полный контекст проекта для AI-ассистентов
- **[.cursorrules](.cursorrules)** - Стандарты и соглашения по кодированию
- **[docs/INDEX.md](docs/INDEX.md)** - Организованный индекс документации

Эти файлы помогают AI-кодинг ассистентам понять структуру проекта, паттерны и соглашения.

## Технологии

**Основные**: Python 3.10+, Poetry, Docker, FastAPI, Pydantic, pytest

**AI/ML**: HuggingFace Transformers, PyTorch, NVIDIA CUDA, 4-bit Quantization, Локальные модели, Файнтюнинг

**Архитектура**: Clean Architecture, Domain-Driven Design, SOLID принципы, LLM-as-Judge паттерн

**Инфраструктура**: Traefik, NVIDIA Container Toolkit, Multi-stage Docker builds, MongoDB, Prometheus

## Документация

Основная документация:
- [DEVELOPMENT.md](docs/DEVELOPMENT.md) - Настройка, деплой и операции
- [ARCHITECTURE.md](docs/ARCHITECTURE.md) - Архитектура системы
- [USER_GUIDE.md](docs/USER_GUIDE.md) - Руководство пользователя
- [API_DOCUMENTATION.md](docs/API_DOCUMENTATION.md) - Справочник по API
- [AGENT_INTEGRATION.ru.md](docs/AGENT_INTEGRATION.ru.md) - Руководство по интеграции MCP-aware агента
- [MONITORING.md](docs/MONITORING.md) - Настройка мониторинга и Grafana дашборды
- [SECURITY.md](docs/SECURITY.md) - Политики безопасности и практики

Документация День 15 (текущая):
- [Руководство по оценке качества и файнтюнингу](docs/day15/README.md)
- [API Документация](docs/day15/api.md)
- [Миграция с Дня 12](docs/day15/MIGRATION_FROM_DAY12.md)

Документация День 12:
- [Руководство пользователя PDF-дайджестов](docs/day12/USER_GUIDE.md)
- [API PDF-дайджестов](docs/day12/api.md)
- [Архитектура PDF-дайджестов](docs/day12/ARCHITECTURE.md)

См. [docs/INDEX.md](docs/INDEX.md) для полного индекса документации.

## Мониторинг

```bash
# Запустить стек мониторинга (Prometheus + Grafana)
docker-compose -f docker-compose.butler.yml up -d prometheus grafana

# Доступ к Grafana: http://localhost:3000 (admin/admin)
# Доступ к Prometheus: http://localhost:9090
```

Доступные дашборды:
1. **App Health** - Системные ресурсы, HTTP метрики, latency, доступность
2. **ML Service Metrics** - LLM inference latency, использование токенов, версионирование моделей
3. **Post Fetcher & PDF Metrics** - Метрики сбора постов и генерации PDF
4. **Quality Assessment Metrics** - Оценки качества, запуски файнтюнинга, рост датасета

См. [MONITORING.md](docs/MONITORING.md) для подробной настройки.

## Как внести свой вклад

Мы приветствуем вклад! См. [CONTRIBUTING.md](CONTRIBUTING.md) для подробных инструкций.

**Основные правила:**
- Следовать PEP 8 и Дзену Python
- Функции максимум 15 строк где возможно
- 100% покрытие типов
- 80%+ покрытие тестами
- Документировать все изменения

## Лицензия

Этот проект лицензирован под MIT License - см. файл LICENSE для деталей.

---

**Примечание**: Это обучающий проект для изучения AI и языковых моделей. Используйте ответственно и в соответствии с применимыми условиями использования.
