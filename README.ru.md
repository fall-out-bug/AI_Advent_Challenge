# AI Advent Challenge

[English](README.md) | [Русский](README.ru.md)

> Ежедневные AI-проекты для изучения языковых моделей и мультиагентных систем

## 🤖 Быстрый старт для AI агентов

**Структура репозитория:**
- `local_models/` - Инфраструктура локальных языковых моделей (общий модуль)
- `shared/` - SDK для унифицированного взаимодействия с моделями (общий модуль)
- `day_01/` до `day_04/` - Обучающие проекты для изучения основ
- `day_05/`, `day_06/` - Продакшн проекты с использованием SDK
- `day_07/` - Мультиагентная система для генерации и ревью кода
- `day_08/` - Система анализа токенов с Clean Architecture
- Каждый `day_XX/` - самостоятельный проект со своими зависимостями и тестами

**Ключевые компоненты:**
- **Локальные модели**: FastAPI серверы в `local_models/` (порты 8000-8002)
- **SDK**: Унифицированный интерфейс для взаимодействия с моделями в `shared/`
- **Чат-боты**: Терминальные приложения с AI-взаимодействием
- **Режим советника**: Структурированный диалог с ограничениями модели
- **Унифицированный API**: команда `api <provider>` для всех моделей
- **Мультиагентная система**: Специализированные агенты для генерации и ревью кода
- **Система анализа токенов**: Профессиональная система с Clean Architecture

**Быстрый старт для агентов:**
1. Изучите `local_models/README.md` - архитектура локальных моделей
2. Выберите проект `day_XX/` по сложности
3. Запустите `make install && make run` в выбранном проекте

## 📁 Структура проекта

```
AI_Advent_Challenge/
├── .gitignore              # Игнорируемые файлы
├── config.py              # Конфигурация API ключей (общая)
├── api_key.txt.example    # Шаблон для API ключей
├── Makefile              # Команды настройки проекта
├── README.md             # Этот файл (английский)
├── README.ru.md          # Русская версия
├── AGENTS.md             # Документация AI агентов (английский)
├── AGENTS.ru.md          # Документация AI агентов (русский)
├── AGENTS_QUICK_REFERENCE.md # Быстрая справка (английский)
├── AGENTS_QUICK_REFERENCE.ru.md # Быстрая справка (русский)
├── local_models/         # 🏠 Инфраструктура локальных языковых моделей
│   ├── chat_api.py       # FastAPI сервер для локальных моделей
│   ├── docker-compose.yml # Docker Compose конфигурация
│   ├── Dockerfile        # Образ для запуска моделей
│   ├── download_model.py # Скрипт для предварительной загрузки моделей
│   └── README.md         # Документация локальных моделей
├── shared/               # 🛠️ SDK для унифицированного взаимодействия с моделями
│   ├── config/          # Конфигурация моделей и константы
│   ├── clients/         # Клиенты моделей
│   ├── exceptions/      # Стандартизированные исключения
│   ├── tests/           # Тесты SDK (98.59% покрытие)
│   ├── pyproject.toml   # Зависимости SDK
│   └── README.md        # Документация SDK
├── day_01/               # День 1 - Терминальный чат с AI
│   ├── terminal_chat.py  # Основное приложение
│   ├── pyproject.toml    # Poetry зависимости
│   ├── .venv/           # Poetry виртуальная среда
│   ├── Makefile         # Команды разработки
│   └── README.md        # Документация проекта
├── day_02/               # День 2 - Улучшенный чат с JSON ответами
│   ├── terminal_chat_v2.py # Улучшенное приложение
│   ├── pyproject.toml    # Poetry зависимости
│   ├── .venv/           # Poetry виртуальная среда
│   ├── Makefile         # Команды разработки
│   └── README.md        # Документация проекта
├── day_03/               # День 3 - Режим советника с ограничениями модели
│   ├── terminal_chat_v3.py # Чат с режимом советника
│   ├── advice_session.py   # Управление состоянием сессии
│   ├── advice_mode.py      # Логика режима советника
│   ├── tests/             # Тесты для всех компонентов
│   ├── pyproject.toml     # Poetry зависимости
│   ├── Makefile          # Команды разработки
│   └── README.md         # Документация проекта
├── day_04/               # День 4 - Улучшенный режим советника с температурой
│   ├── terminal_chat_v4.py # Чат с улучшенным режимом советника
│   ├── advice_mode.py      # Логика режима советника
│   ├── advice_session.py   # Управление состоянием сессии
│   ├── temperature_utils.py # Утилиты температуры
│   ├── experiment_temperature.py # Эксперименты с температурой
│   ├── tests/             # Тесты для всех компонентов
│   ├── pyproject.toml     # Poetry зависимости
│   ├── Makefile          # Команды разработки
│   └── README.md         # Документация проекта
├── day_05/               # День 5 - Локальные модели и история сообщений
│   ├── terminal_chat_v5.py # Чат с поддержкой локальных моделей
│   ├── advice_mode_v5.py   # Режим советника для локальных моделей
│   ├── advice_session.py   # Управление состоянием сессии
│   ├── temperature_utils.py # Утилиты температуры
│   ├── check_models.py     # Проверка доступности локальных моделей
│   ├── demo_*.py          # Демо скрипты
│   ├── tests/             # Тесты для всех компонентов
│   ├── requirements.txt   # Зависимости проекта
│   ├── Makefile          # Команды разработки
│   └── README.md         # Документация проекта
├── day_06/               # День 6 - Тестирование локальных моделей на логических загадках
│   ├── src/              # Исходный код системы тестирования
│   │   ├── main.py       # Основной модуль тестирования
│   │   ├── model_client.py # Клиент локальных моделей
│   │   ├── riddles.py    # Коллекция логических загадок
│   │   ├── report_generator.py # Генератор отчетов
│   │   └── __init__.py   # Инициализация пакета
│   ├── tests/           # Тесты для всех компонентов
│   ├── pyproject.toml   # Poetry зависимости
│   ├── Makefile         # Команды разработки
│   └── README.md        # Документация проекта
├── day_07/               # День 7 - Мультиагентная система для генерации и ревью кода
│   ├── agents/          # Системные агенты
│   │   ├── api/        # FastAPI сервисы для агентов
│   │   │   ├── generator_api.py # API агента генератора
│   │   │   └── reviewer_api.py  # API агента ревьюера
│   │   └── core/       # Ядро агентов (генератор, ревьюер)
│   │       ├── base_agent.py # Базовый класс агента
│   │       ├── code_generator.py # Агент генерации кода
│   │       ├── code_reviewer.py # Агент ревью кода
│   │       └── model_client_adapter.py # Интеграция с моделями
│   ├── communication/   # Слой коммуникации между агентами
│   │   ├── agent_client.py # HTTP клиент с логикой повторов
│   │   └── message_schema.py # Модели запросов/ответов
│   ├── prompts/        # Шаблоны промптов для моделей
│   │   ├── generator_prompts.py # Промпты генерации
│   │   └── reviewer_prompts.py  # Промпты ревью
│   ├── tests/          # Системные тесты
│   │   ├── test_generator.py
│   │   ├── test_reviewer.py
│   │   └── test_orchestrator.py
│   ├── examples/       # Примеры использования
│   ├── orchestrator.py # Оркестратор workflow
│   ├── main.py         # CLI интерфейс
│   ├── demo.py         # Демо примеры
│   ├── Dockerfile      # Многоэтапный Docker образ
│   ├── docker-compose*.yml # Конфигурации развертывания
│   ├── README.md       # Документация проекта (EN)
│   ├── README.ru.md    # Документация проекта (RU)
│   ├── DEVELOPER_GUIDE.md # Руководство разработчика (EN)
│   ├── DEVELOPER_GUIDE.ru.md # Руководство разработчика (RU)
│   ├── ARCHITECTURE.md # Архитектура системы (EN)
│   ├── ARCHITECTURE.ru.md # Архитектура системы (RU)
│   ├── DEPLOYMENT.md   # Руководство по развертыванию (EN)
│   ├── DEPLOYMENT.ru.md # Руководство по развертыванию (RU)
│   ├── TROUBLESHOOTING.md # Руководство по устранению неполадок (EN)
│   ├── TROUBLESHOOTING.ru.md # Руководство по устранению неполадок (RU)
│   ├── pyproject.toml  # Poetry зависимости
│   ├── Makefile        # Команды разработки
│   └── constants.py    # Константы конфигурации
└── day_08/               # День 8 - Система анализа токенов
    ├── core/           # Основная бизнес-логика
    │   ├── token_analyzer.py # Стратегии подсчета токенов
    │   ├── text_compressor.py # Сжатие текста с паттерном Strategy
    │   ├── ml_client.py # ML клиент с логикой повторов
    │   ├── experiments.py # Управление экспериментами
    │   ├── compressors/ # Реализации стратегий сжатия
    │   ├── factories/  # Реализации паттерна Factory
    │   ├── builders/   # Реализации паттерна Builder
    │   └── validators/ # Валидация запросов
    ├── domain/         # Доменный слой (DDD)
    │   ├── entities/   # Доменные сущности
    │   ├── value_objects/ # Неизменяемые объекты-значения
    │   ├── repositories/ # Интерфейсы репозиториев
    │   └── services/   # Доменные сервисы
    ├── application/    # Слой приложения
    │   ├── use_cases/  # Бизнес-сценарии использования
    │   ├── services/   # Сервисы приложения
    │   └── dto/        # Объекты передачи данных
    ├── infrastructure/ # Слой инфраструктуры
    │   ├── repositories/ # Реализации репозиториев
    │   ├── external/   # Интеграции с внешними сервисами
    │   └── config/     # Управление конфигурацией
    ├── tests/          # Комплексный набор тестов
    │   ├── integration/ # End-to-end тесты
    │   ├── regression/ # Тесты базового поведения
    │   ├── performance/ # Тесты производительности
    │   └── mocks/      # Тестовые дублеры
    ├── docs/           # Техническая документация
    │   ├── DEVELOPMENT_GUIDE.md # Практики разработки
    │   ├── DOMAIN_GUIDE.md # Domain-driven design
    │   ├── ML_ENGINEERING.md # Руководство ML framework
    │   └── ASYNC_TESTING_BEST_PRACTICES.md # Руководство по тестированию
    ├── examples/       # Примеры использования
    ├── reports/        # Отчеты демо и анализа
    ├── demo_enhanced.py # Улучшенная демонстрация
    ├── demo.py         # Базовая демонстрация
    ├── README.md       # Комплексная документация (EN)
    ├── README.ru.md    # Краткое резюме (RU)
    ├── architecture.md # Архитектура системы
    ├── api.md          # Справочник API
    ├── TASK.md         # Исходные требования
    ├── TASK_VERIFICATION_REPORT.md # Верификация требований
    ├── PROJECT_SUMMARY.md # Достижения проекта
    ├── pyproject.toml  # Poetry зависимости
    ├── Makefile        # Команды разработки
    └── pytest.ini      # Конфигурация тестов
```

## 🚀 Быстрый старт

### 1. Настройка API ключей

```bash
make setup  # Создает api_key.txt из шаблона
# Добавьте ваши API ключи в api_key.txt:
# perplexity:your_perplexity_key
# chadgpt:your_chadgpt_key
```

### 2. Запуск локальных моделей (опционально)

```bash
# Запустить все локальные модели
cd local_models
docker-compose up -d

# Проверить доступность
curl http://localhost:8000/chat  # Qwen
curl http://localhost:8001/chat  # Mistral
curl http://localhost:8002/chat  # TinyLlama
```

### 3. Выбор проекта

```bash
# День 1 - Простой чат
cd day_01
make install
make chat

# День 2 - Улучшенный чат с JSON ответами
cd ../day_02
make install
make chat

# День 3 - Режим советника с ограничениями модели
cd ../day_03
make install
make run

# День 4 - Улучшенный режим советника с температурой
cd ../day_04
make install
make run

# День 5 - Локальные модели и история сообщений
cd ../day_05
make install
make run

# День 6 - Тестирование локальных моделей на логических загадках
cd ../day_06
make install
make run

# День 7 - Мультиагентная система для генерации и ревью кода
cd ../day_07

# Запустить StarCoder (требуется)
cd ../local_models
docker-compose up -d starcoder-chat

# Запустить агентов через Docker Compose
cd ../day_07
make start-bridge  # Простой запуск
# или
make start-traefik # С Traefik reverse proxy

# CLI использование
make demo          # Запустить демо
make run-simple    # Простая генерация кода

# День 8 - Система анализа токенов
cd ../day_08

# Установить зависимости
make install-dev

# Запустить комплексные тесты
make test

# Запустить демонстрации
make demo          # Базовое демо
make demo-enhanced # Улучшенное демо с отчетами
python examples/task_demonstration.py # Верификация TASK.md
```

## 📊 Сравнение проектов

| Проект | Сложность | Технологии | Модели | Возможности |
|---------|-----------|--------------|--------|----------|
| day_01 | ⭐ | Python, API | Perplexity | Простой чат |
| day_02 | ⭐⭐ | Python, JSON | Perplexity | JSON ответы |
| day_03 | ⭐⭐ | Python, State | Perplexity | Режим советника |
| day_04 | ⭐⭐⭐ | Python, Temperature | Perplexity | Эксперименты с температурой |
| day_05 | ⭐⭐⭐ | Python, SDK, Docker | Локальные | Интеграция SDK |
| day_06 | ⭐⭐⭐⭐ | Python, SDK, Testing | Локальные | Тестирование моделей |
| day_07 | ⭐⭐⭐⭐⭐ | FastAPI, Docker, Traefik | 4 модели | Мультиагентная система |
| day_08 | ⭐⭐⭐⭐⭐ | Clean Architecture, DDD, ML Engineering | 4 модели | Анализ токенов и сжатие |

## 📚 Описания проектов

### Локальные модели - Инфраструктура локальных языковых моделей

🏠 **Общий модуль** для работы с локальными языковыми моделями. Предоставляет унифицированный API для различных моделей и может использоваться любым проектом в репозитории.

**Технологии:**
- FastAPI (API сервер)
- Docker Compose (оркестрация)
- HuggingFace Transformers
- NVIDIA CUDA (GPU ускорение)
- 4-bit квантизация (эффективность памяти)

**Поддерживаемые модели:**
- **Qwen-4B** (порт 8000) - Быстрые ответы, ~8GB RAM
- **Mistral-7B** (порт 8001) - Высокое качество, ~14GB RAM  
- **TinyLlama-1.1B** (порт 8002) - Компактная, ~4GB RAM

**Ключевые возможности:**
- 🔄 **Унифицированный API**: Стандартный OpenAI-совместимый интерфейс
- 🐳 **Docker оркестрация**: Автоматическое управление контейнерами
- 🎯 **Автоформатирование**: Поддержка различных форматов промптов
- ⚡ **GPU ускорение**: Автоматическое использование NVIDIA GPU
- 🔒 **Приватность**: Данные никогда не покидают локальную машину
- 💰 **Экономия средств**: Нет затрат на внешние API

**Быстрый старт:**
```bash
cd local_models
docker-compose up -d
curl http://localhost:8000/chat  # Тест Qwen
```

**Интеграция:**
Используется в `day_05/` и может быть легко подключена к любым будущим проектам.

### Shared SDK - Унифицированное взаимодействие с моделями

🛠️ **Унифицированный SDK** для работы с различными языковыми моделями. Предоставляет согласованный интерфейс независимо от поставщика модели (Perplexity, ChatGPT или локальные модели).

**Ключевые возможности:**
- 🔄 **Унифицированный интерфейс**: Одинаковый API для всех моделей
- 🎯 **Абстракция поставщика**: Легкое переключение между поставщиками
- 📊 **Статистика использования**: Подсчет токенов и отслеживание затрат
- 🔧 **Управление конфигурацией**: Централизованные настройки
- 🛡️ **Обработка ошибок**: Стандартизированная обработка исключений
- 📈 **Мониторинг производительности**: Отслеживание времени ответа

**Поддерживаемые поставщики:**
- **Perplexity**: Высококачественные ответы
- **ChatGPT**: Флагманская модель OpenAI
- **Локальные модели**: Qwen, Mistral, TinyLlama

**Использование:**
```python
from shared.clients.model_client import ModelClient

client = ModelClient(provider="perplexity")
response = await client.chat("Hello, world!")
```

**Интеграция:**
Используется в `day_05/` и `day_06/` для взаимодействия с моделями.

### День 01 - Терминальный чат с AI

**Цель**: Введение в терминальный чат с AI

**Возможности:**
- Простой терминальный интерфейс
- Чат с AI в реальном времени
- Базовая обработка ошибок
- Чистая функция выхода

**Технологии:**
- Python 3.10+
- Perplexity API
- Терминальный интерфейс

**Быстрый старт:**
```bash
cd day_01
make install
make chat
```

### День 02 - Улучшенный чат с JSON ответами

**Цель**: Улучшенный чат со структурированными JSON ответами

**Возможности:**
- JSON-форматированные ответы
- Лучшая обработка ошибок
- Улучшенный пользовательский опыт
- Валидация ответов

**Технологии:**
- Python 3.10+
- Perplexity API
- Обработка JSON
- Pydantic валидация

**Быстрый старт:**
```bash
cd day_02
make install
make chat
```

### День 03 - Режим советника с ограничениями модели

**Цель**: Структурированный диалог с режимом AI советника

**Возможности:**
- Режим советника с ограничениями
- Управление состоянием сессии
- Сохранение контекста
- Структурированные ответы

**Технологии:**
- Python 3.10+
- Perplexity API
- Управление состоянием
- Обработка контекста

**Быстрый старт:**
```bash
cd day_03
make install
make run
```

### День 04 - Улучшенный режим советника с температурой

**Цель**: Улучшенный режим советника с контролем температуры

**Возможности:**
- Вариация ответов на основе температуры
- Продвинутый режим советника
- Инструменты экспериментирования
- Метрики производительности

**Технологии:**
- Python 3.10+
- Perplexity API
- Утилиты температуры
- Фреймворк экспериментирования

**Быстрый старт:**
```bash
cd day_04
make install
make run
```

### День 05 - Локальные модели и история сообщений

**Цель**: Интеграция с локальными моделями и история сообщений

**Возможности:**
- Поддержка локальных моделей
- История сообщений
- Унифицированный API
- Интеграция SDK

**Технологии:**
- Python 3.10+
- Shared SDK
- Локальные модели
- Docker интеграция

**Быстрый старт:**
```bash
cd day_05
make install
make run
```

### День 06 - Тестирование локальных моделей на логических загадках

**Цель**: Комплексное тестирование локальных моделей на логических загадках

**Возможности:**
- Тестирование логических загадок
- Сравнение моделей
- Генерация отчетов
- Анализ производительности

**Технологии:**
- Python 3.10+
- Shared SDK
- Фреймворк тестирования
- Генерация отчетов

**Быстрый старт:**
```bash
cd day_06
make install
make run
```

### День 07 - Мультиагентная система для генерации и ревью кода

🤖 **Профессиональная система** для автоматической генерации и ревью Python кода с использованием специализированных AI агентов. Поддерживает множественные языковые модели (StarCoder, Mistral, Qwen, TinyLlama).

#### Архитектура

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Оркестратор   │    │  Генератор кода │    │  Ревьюер кода   │
│                 │    │     Агент       │    │     Агент       │
│  - Координирует │◄──►│  - Генерирует   │◄──►│  - Ревьюит      │
│  - Управляет    │    │  - Создает      │    │  - Анализирует  │
│  - Сохраняет    │    │  - Валидирует   │    │  - Оценивает    │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │                       │
         └───────────────────────┼───────────────────────┘
                                 │
                    ┌─────────────────┐
                    │  Shared SDK     │
                    │  - StarCoder    │
                    │  - Mistral      │
                    │  - Qwen         │
                    │  - TinyLlama    │
                    └─────────────────┘
```

#### Технологии
- FastAPI (REST API для агентов)
- Docker Compose (оркестрация сервисов)
- Traefik (reverse proxy и load balancer)
- Poetry (управление зависимостями)
- Shared SDK (унифицированное взаимодействие с моделями)
- Pydantic (валидация данных)
- pytest (тестирование)

#### Поддерживаемые модели
- **StarCoder-7B** (по умолчанию) - Специализирован для генерации кода
- **Mistral-7B** - Высокое качество, универсальная модель
- **Qwen-4B** - Быстрые ответы, хорошее качество
- **TinyLlama-1.1B** - Компактная и быстрая

#### Ключевые компоненты

**1. Агент генератора кода (порт 9001)**
- Генерирует Python функции из описаний
- Создает комплексные тесты
- Валидирует сгенерированный код
- Поддерживает улучшение кода
- API endpoints: /generate, /refine, /validate

**2. Агент ревьюера кода (порт 9002)**
- Анализирует качество кода
- Проверяет соответствие PEP8
- Оценивает покрытие тестами
- Вычисляет сложность кода
- API endpoints: /review, /analyze-pep8, /calculate-complexity

**3. Оркестратор**
- Координирует workflow между агентами
- Управляет обработкой задач
- Сохраняет результаты
- Собирает статистику
- Обрабатывает ошибки с логикой повторов

**4. Слой коммуникации**
- HTTP клиент с логикой повторов
- Экспоненциальная задержка для устойчивости
- Pydantic модели для валидации
- Структурированные запросы/ответы

#### Ключевые возможности

- ✨ **Поддержка множественных моделей**: Выбор из 4 языковых моделей
- 🤖 **Специализированные агенты**: Отдельные агенты для генерации и ревью
- 🔄 **Оркестрация workflow**: Автоматическая координация агентов
- 📊 **Метрики качества**: PEP8, покрытие тестами, сложность
- 🐳 **Docker развертывание**: Множественные варианты развертывания
- 🔍 **Мониторинг здоровья**: Endpoints для проверки статуса
- 📈 **Статистика**: Детальные метрики производительности агентов
- 🛡️ **Обработка ошибок**: Логика повторов с экспоненциальной задержкой
- 📝 **Комплексная документация**: 5 документов включая архитектуру и развертывание
- 🔒 **Безопасность**: Многоэтапные Docker сборки, пользователи не root

#### Варианты развертывания

**Bridge Network (простой)**:
```bash
make start-bridge
```
- Генератор: http://localhost:9001
- Ревьюер: http://localhost:9002

**Traefik Reverse Proxy (продакшн)**:
```bash
make start-traefik
```
- Генератор: http://generator.localhost
- Ревьюер: http://reviewer.localhost
- Traefik Dashboard: http://localhost:8080

#### Примеры использования

**CLI генерация**:
```bash
python main.py "Создать функцию для вычисления чисел Фибоначчи"
```

**Python API**:
```python
from orchestrator import MultiAgentOrchestrator
from communication.message_schema import OrchestratorRequest

orchestrator = MultiAgentOrchestrator()

# Простая генерация
request = OrchestratorRequest(
    task_description="Создать REST API endpoint",
    model_name="starcoder"
)
result = await orchestrator.process_task(request)

# Разные модели для генерации и ревью
request = OrchestratorRequest(
    task_description="Создать пайплайн обработки данных",
    model_name="starcoder",
    reviewer_model_name="mistral"
)
result = await orchestrator.process_task(request)
```

### День 08 - Система анализа токенов

🎯 **Продакшн-готовая система** для анализа токенов, сжатия и взаимодействия с ML моделями. Особенности Clean Architecture с Domain-Driven Design, комплексное тестирование и ML Engineering framework.

#### Архитектура

```
┌─────────────────────────────────────────────────────────────────┐
│                    Day 08 Enhanced System                       │
├─────────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐            │
│  │   Demo      │  │   Enhanced  │  │  SDK        │            │
│  │  Scripts    │  │  Features   │  │  Adapters   │            │
│  │             │  │             │  │             │            │
│  │ • Enhanced  │  │ • Model     │  │ • Generator │            │
│  │ • Model     │  │   Switching │  │ • Reviewer  │            │
│  │   Switching │  │ • Quality   │  │ • Direct    │            │
│  │ • Reports   │  │   Analysis  │  │ • REST      │            │
│  └─────────────┘  └─────────────┘  └─────────────┘            │
│         │                 │                 │                  │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │              Core Day 08 Components                        │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐        │ │
│  │  │   Token     │  │   Text      │  │   ML        │        │ │
│  │  │   Counter   │  │  Compressor │  │   Client    │        │ │
│  │  │             │  │             │  │             │        │ │
│  │  │ • Simple    │  │ • Strategy  │  │ • Retry     │        │ │
│  │  │ • Accurate  │  │ • Template  │  │ • Circuit   │        │ │
│  │  │ • Hybrid    │  │ • Factory   │  │ • Breaker   │        │ │
│  │  └─────────────┘  └─────────────┘  └─────────────┘        │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐        │ │
│  │  │   Model     │  │   Token     │  │ Compression │        │ │
│  │  │   Switcher  │  │   Limit    │  │ Evaluator   │        │ │
│  │  │             │  │   Tester   │  │             │        │ │
│  │  │ • SDK       │  │ • Three-   │  │ • All       │        │ │
│  │  │   Workflow  │  │   Stage    │  │   Algorithms│        │ │
│  │  │ • Quality   │  │ • Dynamic  │  │ • Quality   │        │ │
│  │  │   Analysis  │  │ • Model-   │  │ • Performance│       │ │
│  │  │             │  │   Specific │  │             │        │ │
│  │  └─────────────┘  └─────────────┘  └─────────────┘        │ │
│  └─────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
```

#### Технологии

- **Clean Architecture**: Domain, Application, Infrastructure, Presentation слои
- **Domain-Driven Design**: Сущности, value objects, репозитории, доменные сервисы
- **SOLID принципы**: Единая ответственность, dependency injection, разделение интерфейсов
- **Паттерны дизайна**: Strategy, Factory, Builder, Template Method, Circuit Breaker, Facade
- **ML Engineering**: Оценка моделей, мониторинг производительности, отслеживание экспериментов, реестр моделей
- **Комплексное тестирование**: 282 теста с 74% покрытием, интеграционные, регрессионные, тесты производительности
- **Типобезопасность**: 100% покрытие type hints в основных модулях
- **Обеспечение качества**: Строгий линтинг, pre-commit хуки, сканирование безопасности

#### Поддерживаемые модели

- **StarCoder-7B** (по умолчанию) - Специализирован для генерации кода
- **Mistral-7B** - Высокое качество, универсальная модель
- **Qwen-4B** - Быстрые ответы, хорошее качество
- **TinyLlama-1.1B** - Компактная и быстрая

#### Ключевые компоненты

**1. Анализ токенов (`core/token_analyzer.py`)**
- Множественные стратегии подсчета (простая оценка, ML-основанная, гибридная)
- Лимиты и валидация для конкретных моделей
- Подсчет токенов ввода/вывода для запросов и ответов
- Поддержка всех моделей с точной оценкой токенов

**2. Сжатие текста (`core/text_compressor.py`)**
- Паттерн Strategy с 5 алгоритмами сжатия
- Усечение, ключевые слова, извлечение, семантика, суммаризация
- Автоматическое сжатие при превышении лимитов запросов
- Расчет коэффициента сжатия и анализ качества

**3. ML клиент (`core/ml_client.py`)**
- Устойчивый клиент с логикой повторов и circuit breaker
- Валидация запросов и обработка ошибок
- Мониторинг производительности и статистика
- Интеграция с SDK агентами

**4. Эксперименты (`core/experiments.py`)**
- Паттерн Builder для построения результатов экспериментов
- Комплексное отслеживание и управление экспериментами
- Сравнение и анализ моделей
- Структурированное логирование и отчетность

#### Ключевые возможности

- ✨ **Анализ токенов**: Точный подсчет токенов с множественными стратегиями
- 🗜️ **Сжатие текста**: 5 алгоритмов сжатия с оценкой качества
- 🏗️ **Clean Architecture**: Domain-driven design с SOLID принципами
- 🧪 **Комплексное тестирование**: 282 теста с отличным покрытием
- 📊 **ML Engineering**: Продакшн-готовый MLOps framework
- 🔄 **Интеграция SDK**: Унифицированная интеграция агентной системы
- 📈 **Мониторинг производительности**: Детальные метрики и аналитика
- 🛡️ **Обработка ошибок**: Надежное управление исключениями и логика повторов
- 📝 **Документация**: 12+ комплексных руководств и примеров
- 🔒 **Безопасность**: Валидация ввода и сканирование безопасности

#### Выполнение требований TASK.md

✅ **Требование 1: Подсчет токенов**
- Реализация: `core/token_analyzer.py`
- Возможности: Подсчет токенов ввода/вывода, множественные стратегии, лимиты моделей
- Верификация: Все модели протестированы с точным подсчетом токенов

✅ **Требование 2: Сравнение запросов**
- Реализация: `core/token_limit_tester.py`
- Возможности: Трехэтапное тестирование (короткие/средние/длинные запросы)
- Верификация: Комплексный анализ запросов и документация поведения

✅ **Требование 3: Сжатие текста**
- Реализация: `core/text_compressor.py` с паттерном Strategy
- Возможности: 5 алгоритмов сжатия, автоматическое применение
- Верификация: Сжатие применяется к запросам, превышающим лимиты

#### Метрики производительности

- **Подсчет токенов**: ~0.1ms на 1000 символов
- **Сжатие текста**: ~5ms на 10KB текста
- **ML запросы**: ~200ms среднее время ответа
- **Использование памяти**: ~50MB базовое
- **Выполнение тестов**: 282 теста за ~4.6 секунды
- **Покрытие кода**: 74% с комплексным набором тестов

#### Продакшн-готовые возможности

- ✅ **Надежная обработка ошибок**: Комплексная иерархия исключений
- ✅ **Типобезопасность**: 100% type hints в основных модулях
- ✅ **Безопасность**: Валидация и санитизация ввода
- ✅ **Мониторинг**: Метрики производительности и проверки здоровья
- ✅ **Документация**: Полный справочник API и руководства
- ✅ **Тестирование**: Unit, интеграционные, регрессионные, тесты производительности
- ✅ **Качество**: Соответствие PEP8, линтинг, pre-commit хуки
- ✅ **Архитектура**: Clean Architecture с DDD паттернами

#### Примеры использования

**Базовый подсчет токенов:**
```python
from core.token_analyzer import SimpleTokenCounter
from tests.mocks.mock_config import MockConfiguration

config = MockConfiguration()
counter = SimpleTokenCounter(config=config)
token_info = counter.count_tokens("Hello world", "starcoder")
print(f"Токены: {token_info.count}")
```

**Сжатие текста:**
```python
from core.text_compressor import SimpleTextCompressor

compressor = SimpleTextCompressor(token_counter)
result = compressor.compress_text(
    text="Очень длинный текст...",
    max_tokens=1000,
    model_name="starcoder",
    strategy="truncation"
)
print(f"Коэффициент сжатия: {result.compression_ratio}")
```

**Запуск экспериментов:**
```python
from core.experiments import TokenLimitExperiments

experiments = TokenLimitExperiments(ml_client, token_counter, compressor)
results = await experiments.run_limit_exceeded_experiment("starcoder")
```

#### Следующие шаги

1. Изучите комплексную документацию в `day_08/README.md`
2. Запустите `make demo` чтобы увидеть анализ токенов в действии
3. Изучите `examples/task_demonstration.py` для верификации TASK.md
4. Просмотрите директорию `docs/` для технических руководств
5. Интегрируйте анализ токенов в ваши собственные проекты
6. Расширьте стратегии сжатия для конкретных случаев использования

## 🛠️ Технологии и зависимости

### Основные технологии
- **Python 3.10+**: Основной язык программирования
- **Poetry**: Управление зависимостями
- **Docker**: Контейнеризация
- **Docker Compose**: Оркестрация сервисов
- **FastAPI**: Web фреймворк для API
- **Pydantic**: Валидация данных
- **pytest**: Фреймворк тестирования

### AI/ML технологии
- **HuggingFace Transformers**: Интеграция моделей
- **NVIDIA CUDA**: GPU ускорение
- **4-bit квантизация**: Оптимизация памяти
- **Локальные модели**: Qwen, Mistral, TinyLlama, StarCoder
- **Анализ токенов**: Продвинутые стратегии подсчета и сжатия токенов
- **ML Engineering**: Оценка моделей, мониторинг, отслеживание экспериментов

### Технологии архитектуры и дизайна
- **Clean Architecture**: Domain, Application, Infrastructure слои
- **Domain-Driven Design**: Сущности, value objects, репозитории
- **SOLID принципы**: Паттерны дизайна и лучшие практики
- **Паттерны дизайна**: Strategy, Factory, Builder, Template Method, Circuit Breaker
- **Типобезопасность**: Комплексные type hints и валидация

### Инфраструктурные технологии
- **Traefik**: Reverse proxy и load balancer
- **NVIDIA Container Toolkit**: Поддержка GPU
- **Многоэтапные Docker сборки**: Безопасность и оптимизация

## 🤝 Вклад в проект

Мы приветствуем вклад! Пожалуйста, смотрите отдельные README файлы проектов для конкретных руководящих принципов вклада.

### Общие принципы
1. Форкните репозиторий
2. Создайте ветку функции
3. Внесите изменения
4. Добавьте тесты если применимо
5. Отправьте pull request

### Стандарты кода
- Следуйте PEP 8 для Python кода
- Используйте type hints
- Пишите комплексные тесты
- Документируйте ваши изменения
- Следуйте существующим паттернам

## 📄 Лицензия

Этот проект лицензирован под MIT License - см. файл LICENSE для деталей.

## 🙏 Благодарности

- HuggingFace за хостинг моделей и библиотеку transformers
- OpenAI за вдохновение API
- Сообщество open-source за инструменты и библиотеки
- Участники и пользователи этого проекта

---

**Примечание**: Это обучающий проект для изучения AI и языковых моделей. Используйте ответственно и в соответствии с применимыми условиями обслуживания.